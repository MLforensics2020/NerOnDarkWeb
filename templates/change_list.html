{% extends 'admin/change_list.html' %}
{% block object-tools %}
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Popper JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<style>
    #toolbar #searchbar {
        height: auto !important;
        padding: 0px !important;
    }
</style>
<script>
    $(document).ready(function () {
        let file = null;

        //when uploading a file take the file
        $("#onionCsv").on("change", function () {
            file = this.files[0]
        });

        $("#uploadOnionCsv").on("click", function () {
            let data = new FormData();
            data.append("file", file);
            let $crf_token = $('[name="csrfmiddlewaretoken"]').attr('value');
            $.ajax({
                url: '/crawler/add-onion-file/',
                type: 'POST',
                headers:{"X-CSRFToken": $crf_token},
                data: data,
                contentType: false,
                processData: false,
                success: function (data, status, xhr) {
                    $('#myModal').modal('hide');
                    alert("Successfully uploaded links")
                },
                error: function (data, status, xhr) {
                    alert("Unable to upload")
                }
            });
        })
    })
</script>

<!-- The Modal -->
<div class="modal" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Upload CSV file with Onion links</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <span class="font-sm  text-danger hint">
                    *CSV should have 2 columns : Name and Link.
                    Link field is mandatory while Name is optional.
                    Sequence must be Name , Link .
                </span>
                <div style="height: 40px;" class="d-flex w-100 m-auto">
                    <form id="onionForm" enctype='multipart/form-data' method="post">
                        <input type="file" name="onionCsv" id="onionCsv">
                    </form>
                </div>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-success" id="uploadOnionCsv">Upload</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>
<div class="d-flex">
    <button data-toggle="modal" data-target="#myModal" class="btn btn-rounded btn-secondary" type="button">Upload
        Links</button>
</div>
{{ block.super }}
{% endblock %}